# 网络

## 7层架构

1. 物理层，物理设备标准（网线、光纤接口定义），数据叫做比特
2. 数据链路层，Mac地址（网卡）封装和解封，工作设备是交换机，数据是帧
3. 网络层，IP地址封装和解封，工作设备时路由器，数据是包
4. 传输层，传输协议和端口号（UDP、TCP协议，www的80端口），分段传输，数据是段
5. 会话层，建立数据的通路（端口：传输端口和接收端口）
6. 表现层，解释、加密解密、压缩解压缩，把计算器识别的东西转换成人能识别的东西（图像、声音）
7. 应用层，终端应用，FTP文件下载、WEB浏览器等

## TCP三次握手和四次挥手

### 三次握手

1. 主机A发送SYN=1和seq=x的数据包（SYN包）给主机B，主机A进入SYN_SENT状态
2. 主机B通过SYN=1知道主机A要建立链接，发送SYN=1，ACK=1，ack=x+1和seq=y的数据包（SYN包+ACK包）给服务器A，主机B进入SYN_RECV状态
3. 主机A检查ACK是否正确，若正确发送ACK=1，ack=y+1的数据包（ACK包），B检查ack是否正确，正确则建立TCP链接，双方进入ESTBLISHED状态

### 四次挥手

1. 主机A发送FIN=1和seq=x的数据包（FIN包）给主机B，主机A进入FIN_WAIT_1（等待终止1）状态
2. 主机B收到FIN包后，发送一个ACK=1，ack=x+1和seq=y的数据包给主机A，主机B进入CLOSE_WAIT（关闭等待）状态
3. 主机A确认B的ack，若正确，则进入FIN_WAIT_2（等待终止2）状态，停止发送数据，等待主机B接收完数据后的关闭信号
4. 主机B接收完数据后发送FIN=1和seq=z的数据包给主机A，自己进入LAST_ACK（最后确认）状态等待主机A的确认信号
5. 主机A收到FIN包后，发送一个ACK=1，ack=z+1的数据包给主机B，自己进入TIME_WAIT，此时TCP还没释放掉，需要等到2∗MSL（最长报文段寿命）后主机A才会关闭TCP链接
6. 主机B确认主机A的ack，若正确则关闭TCP链接，进入CLOSED状态

