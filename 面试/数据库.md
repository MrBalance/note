# 数据库

## 事务特性

原子性、一致性、隔离性、持久化

## 隔离级别

* 读取未提交内容（**写加锁，读不加锁**）：禁止第一类事务丢失，但会出现其他并发问题
* 读取提交内容（**写加锁，读加锁**）：禁止第一类事务丢失和脏读
* 可重复读（**写加锁，读加锁**）：默认级别，
* 可序列化（**对表级读写加锁**）：

1. 脏读（**读取未提交的新事务，然后被回滚了**）：事务A读取了事务B中尚未提交的数据。如果事务B回滚，则A读取使用了错误的数据。
2. 不可重复读（**读取了提交的新事务，指更新操作**）：对于数据库中的某个数据，一个事务范围内多次查询却返回了不同的数据值，这是由于在查询间隔，被另一个事务修改并提交了。
3. 虚读（幻读）（**读取了提交的新事物，指增删操作**）：在事务A多次读取构成中，事务B对数据进行了新增操作，导致事务A多次读取的数据不一致。

第一类事务丢失（**回滚丢失**）：A事务和B事务同时执行一个数据，B事务提交了，A事务回滚了，B因为A的回滚而消失了

第二类事务丢失（**提交覆盖丢失**）：A事务和B事务同时执行一个数据，B事务先提交，A事务后提交，A覆盖了B

| 隔离级别       | 脏读 | 不可重复读 | 幻读 |
| -------------- | ---- | ---------- | ---- |
| 读取未提交内容 | 是   | 是         | 是   |
| 读取提交内容   | 否   | 是         | 是   |
| 可重复读       | 否   | 否         | 是   |
| 序列化         | 否   | 否         | 否   |

## 索引类别

* index 普通索引，数据可重复
* unique 唯一索引
* primary key 主键索引
* fulltext 全文索引

## 数据库优化

1. 选取适用的字段属性
2. 使用连接（join）代替子查询
3. 使用联合（union）来代替手动创建临时表
4. 事务
5. 锁定表
6. 使用外键
7. 使用索引
8. 优化查询语句

- SQL语句优化
- 正确使用索引
- 合理的数据库设计，三范示
- 硬件优化
- 分表，分库
- 主从，读写分离
- 缓存

## 索引失效

not in 、in、 like %_ 开头、null判断、!=或者<>、or

## SQL优化

少用（不用）自带函数

连续数值条件，用between不用IN